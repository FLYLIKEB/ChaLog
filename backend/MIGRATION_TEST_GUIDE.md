# ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” í…ŒìŠ¤íŠ¸ DBì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„

### 1. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±

MySQLì— í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

```sql
CREATE DATABASE chalog_test CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

#### ë°©ë²• A: í™˜ê²½ ë³€ìˆ˜ ì§ì ‘ ì„¤ì • (ê¶Œì¥)

```bash
export TEST_DATABASE_URL=mysql://username:password@localhost:3306/chalog_test
```

#### ë°©ë²• B: .env.test íŒŒì¼ ìƒì„±

```bash
cd backend
cat > .env.test << EOF
TEST_DATABASE_URL=mysql://username:password@localhost:3306/chalog_test
DB_SSL_ENABLED=false
DB_SSL_REJECT_UNAUTHORIZED=false
DB_SYNCHRONIZE=false
NODE_ENV=test
EOF
```

## ğŸ§ª ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

### ë°©ë²• 1: í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš© (ê¶Œì¥)

```bash
cd backend
export TEST_DATABASE_URL=mysql://username:password@localhost:3306/chalog_test
./scripts/test-migration.sh
```

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
1. ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
3. ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ ì¬í™•ì¸
4. E2E í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì„ íƒì‚¬í•­)

### ë°©ë²• 2: ìˆ˜ë™ ì‹¤í–‰

#### 1ë‹¨ê³„: ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸

```bash
cd backend
export TEST_DATABASE_URL=mysql://username:password@localhost:3306/chalog_test
NODE_ENV=test npm run migration:show
```

#### 2ë‹¨ê³„: ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

```bash
NODE_ENV=test npm run migration:run
```

ë˜ëŠ” ìŠ¤í‚¤ë§ˆ ë™ê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©:

```bash
TEST_DATABASE_URL=mysql://username:password@localhost:3306/chalog_test ./scripts/sync-schema.sh test
```

#### 3ë‹¨ê³„: ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ ì¬í™•ì¸

```bash
NODE_ENV=test npm run migration:show
```

#### 4ë‹¨ê³„: í…Œì´ë¸” ìƒì„± í™•ì¸

MySQLì— ì§ì ‘ ì—°ê²°í•˜ì—¬ í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸:

```sql
USE chalog_test;

-- ìƒˆë¡œ ìƒì„±ëœ í…Œì´ë¸” í™•ì¸
SHOW TABLES LIKE 'rating%';
SHOW TABLES LIKE 'note_axis%';

-- rating_schema í…Œì´ë¸” êµ¬ì¡° í™•ì¸
DESCRIBE rating_schema;

-- rating_axis í…Œì´ë¸” êµ¬ì¡° í™•ì¸
DESCRIBE rating_axis;

-- note_axis_value í…Œì´ë¸” êµ¬ì¡° í™•ì¸
DESCRIBE note_axis_value;

-- notes í…Œì´ë¸” êµ¬ì¡° í™•ì¸ (ìƒˆ ì»¬ëŸ¼ ì¶”ê°€ í™•ì¸)
DESCRIBE notes;

-- ê¸°ë³¸ ìŠ¤í‚¤ë§ˆ ë°ì´í„° í™•ì¸
SELECT * FROM rating_schema;
SELECT * FROM rating_axis;
```

#### 5ë‹¨ê³„: E2E í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
npm run test:e2e
```

## âœ… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸:

- [ ] `rating_schema` í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆëŠ”ê°€?
- [ ] `rating_axis` í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆëŠ”ê°€?
- [ ] `note_axis_value` í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆëŠ”ê°€?
- [ ] `notes` í…Œì´ë¸”ì— `schemaId`, `overallRating`, `isRatingIncluded` ì»¬ëŸ¼ì´ ì¶”ê°€ë˜ì—ˆëŠ”ê°€?
- [ ] `notes` í…Œì´ë¸”ì—ì„œ `rating`, `ratings` ì»¬ëŸ¼ì´ ì œê±°ë˜ì—ˆëŠ”ê°€?
- [ ] ê¸°ë³¸ ìŠ¤í‚¤ë§ˆ (STANDARD v1.0.0)ê°€ ìƒì„±ë˜ì—ˆëŠ”ê°€?
- [ ] ê¸°ë³¸ ì¶•ë“¤ (RICHNESS, STRENGTH, SMOOTHNESS, CLARITY, COMPLEXITY)ì´ ìƒì„±ë˜ì—ˆëŠ”ê°€?
- [ ] ê¸°ì¡´ ë…¸íŠ¸ ë°ì´í„°ê°€ ë§ˆì´ê·¸ë ˆì´ì…˜ë˜ì—ˆëŠ”ê°€? (ê¸°ì¡´ ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°)
- [ ] ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
- [ ] ì¸ë±ìŠ¤ê°€ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ì—ˆëŠ”ê°€?

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± í…ŒìŠ¤íŠ¸

ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë¡¤ë°±í•˜ì—¬ `down` ë©”ì„œë“œê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸:

```bash
cd backend
export TEST_DATABASE_URL=mysql://username:password@localhost:3306/chalog_test
NODE_ENV=test npm run migration:revert
```

ë¡¤ë°± í›„:
- [ ] `rating_schema`, `rating_axis`, `note_axis_value` í…Œì´ë¸”ì´ ì‚­ì œë˜ì—ˆëŠ”ê°€?
- [ ] `notes` í…Œì´ë¸”ì˜ ê¸°ì¡´ ì»¬ëŸ¼ (`rating`, `ratings`)ì´ ë³µì›ë˜ì—ˆëŠ”ê°€?
- [ ] ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ê²Œ ë³µì›ë˜ì—ˆëŠ”ê°€?

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **í”„ë¡œë•ì…˜ DB ì‚¬ìš© ê¸ˆì§€**
   - í…ŒìŠ¤íŠ¸ DB ì´ë¦„ì— `test` ë˜ëŠ” `_test`ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
   - í”„ë¡œë•ì…˜ DBë¥¼ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ê°€ ì†ì‹¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2. **MySQL ì„œë²„ ì‹¤í–‰ í™•ì¸**
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì „ì— MySQL ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.
   - ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ í¬íŠ¸ì™€ í˜¸ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.

3. **ê¸°ì¡´ ë°ì´í„° ë°±ì—…**
   - í…ŒìŠ¤íŠ¸ DBì— ì¤‘ìš”í•œ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ë°±ì—…í•˜ì„¸ìš”.
   - ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

4. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ**
   - ë§ˆì´ê·¸ë ˆì´ì…˜ì€ íƒ€ì„ìŠ¤íƒ¬í”„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.
   - ì´ì „ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ëª¨ë‘ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

## ğŸ› ë¬¸ì œ í•´ê²°

### MySQL ì—°ê²° ì‹¤íŒ¨

```
Error: connect ECONNREFUSED
```

**í•´ê²° ë°©ë²•:**
1. MySQL ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸: `mysql -u username -p -h localhost -P 3306`
2. í¬íŠ¸ ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
3. í˜¸ìŠ¤íŠ¸ ì£¼ì†Œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
4. ë°©í™”ë²½ ì„¤ì • í™•ì¸

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì‹¤íŒ¨

**í•´ê²° ë°©ë²•:**
1. ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸: `npm run migration:show`
2. ì´ì „ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ëª¨ë‘ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸
3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì™€ ì—”í‹°í‹°ê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
4. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì˜ SQL ë¬¸ë²• í™•ì¸

### ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ ì˜¤ë¥˜

**í•´ê²° ë°©ë²•:**
1. ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì´ ë¨¼ì € ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
2. ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ í™•ì¸
3. ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ì„ ì¼ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™”í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

## ğŸ“š ì°¸ê³  ìë£Œ

- [`MIGRATION_WORKFLOW.md`](./MIGRATION_WORKFLOW.md) - ë§ˆì´ê·¸ë ˆì´ì…˜ ì›Œí¬í”Œë¡œìš°
- [`MIGRATIONS.md`](./MIGRATIONS.md) - ë§ˆì´ê·¸ë ˆì´ì…˜ ì‚¬ìš© ê°€ì´ë“œ
- [`TEST_DATABASE_SETUP.md`](./TEST_DATABASE_SETUP.md) - í…ŒìŠ¤íŠ¸ DB ì„¤ì •

