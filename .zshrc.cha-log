# ChaLog í”„ë¡œì íŠ¸ìš© zsh ì„¤ì •
# ì´ íŒŒì¼ì„ ~/.zshrcì— ì¶”ê°€í•˜ê±°ë‚˜ sourceë¡œ ë¡œë“œí•˜ì„¸ìš”
# 
# ì‚¬ìš©ë²•:
#   echo "source $(pwd)/.zshrc.cha-log" >> ~/.zshrc
#   ë˜ëŠ”
#   source .zshrc.cha-log

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬
export CHALOG_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" 2>/dev/null && pwd || echo "$HOME/Documents/programming/ChaLog")"

# EC2 ë¡œê·¸ í™•ì¸ alias
alias ec2logs='$CHALOG_ROOT/scripts/view-ec2-logs.sh'
alias ec2log='ec2logs pm2'
alias ec2logf='ec2logs pm2 -f'
alias ec2status='ec2logs status'
alias ec2error='ec2logs error'
alias ec2nginx='ec2logs nginx'

# EC2 ì„¤ì • íŒŒì¼ í¸ì§‘
alias ec2config='nano $CHALOG_ROOT/.ec2-config'

# EC2 ì„¤ì • íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
if [ -f "$CHALOG_ROOT/.ec2-config" ]; then
    while IFS='=' read -r key value; do
        # ì£¼ì„ ì œê±°
        key=$(echo "$key" | sed 's/#.*$//')
        value=$(echo "$value" | sed 's/#.*$//')
        # ê³µë°± ì œê±°
        key=$(echo "$key" | xargs)
        value=$(echo "$value" | xargs)
        # ë¹ˆ ì¤„ì´ë‚˜ ì£¼ì„ë§Œ ìˆëŠ” ì¤„ ê±´ë„ˆë›°ê¸°
        if [ -n "$key" ] && [ -n "$value" ]; then
            export "$key=$value"
        fi
    done < "$CHALOG_ROOT/.ec2-config"
fi

# ë„ì›€ë§ í•¨ìˆ˜
ec2logs-help() {
    echo "ğŸ“‹ ChaLog EC2 ë¡œê·¸ í™•ì¸ ëª…ë ¹ì–´"
    echo ""
    echo "ê¸°ë³¸ ëª…ë ¹ì–´:"
    echo "  ec2logs pm2          PM2 ë¡œê·¸ í™•ì¸"
    echo "  ec2logs pm2 -f        PM2 ì‹¤ì‹œê°„ ë¡œê·¸"
    echo "  ec2logs status       PM2 ìƒíƒœ í™•ì¸"
    echo "  ec2logs error        ì—ëŸ¬ ë¡œê·¸ í™•ì¸"
    echo "  ec2logs nginx        Nginx ë¡œê·¸ í™•ì¸"
    echo ""
    echo "ê°„ë‹¨í•œ alias:"
    echo "  ec2log               PM2 ë¡œê·¸ (ìµœê·¼ 100ì¤„)"
    echo "  ec2logf              PM2 ì‹¤ì‹œê°„ ë¡œê·¸"
    echo "  ec2status            PM2 ìƒíƒœ"
    echo "  ec2error             ì—ëŸ¬ ë¡œê·¸"
    echo "  ec2nginx             Nginx ë¡œê·¸"
    echo ""
    echo "ì„¤ì •:"
    echo "  ec2config            .ec2-config íŒŒì¼ í¸ì§‘"
    echo ""
    echo "ë„ì›€ë§:"
    echo "  ec2logs --help       ìƒì„¸ ë„ì›€ë§"
}

